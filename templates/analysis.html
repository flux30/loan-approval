<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis - Rule-Based Expert System</title>
    
    <!-- Lexend Font -->
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- GSAP Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="logo-icon">‚öñÔ∏è</span>
                <span class="logo-text">LoanExpert AI</span>
            </div>
            <ul class="nav-menu">
                <li><a href="/" class="nav-link">Home</a></li>
                <li><a href="/analysis" class="nav-link active">Analysis</a></li>
                <li><a href="/documentation" class="nav-link">Docs</a></li>
                <li><a href="#contact" class="nav-link">Contact</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" style="min-height: 60vh; padding-top: 150px;">
        <div class="hero-content">
            <h1 class="hero-title">
                System <span class="gradient-text">Analysis</span>
            </h1>
            <p class="hero-subtitle">
                Deep dive into the rule-based expert system architecture, inference mechanisms, and decision-making process
            </p>
        </div>
    </section>

    <!-- System Rules Section -->
    <section class="features">
        <h2 class="section-title">Knowledge Base Rules</h2>
        <div class="rules-container">
            <div id="rulesGrid" class="rules-grid">
                <!-- Rules populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Inference Mechanisms Section -->
    <section class="analysis-section">
        <div class="analysis-container">
            <h2 class="section-title">Inference Mechanisms</h2>
            <div class="mechanisms-grid">
                <!-- Forward Chaining -->
                <div class="mechanism-card">
                    <div class="mechanism-icon">üîÑ</div>
                    <h3>Forward Chaining</h3>
                    <p class="mechanism-description">
                        Bottom-up reasoning that starts with known facts about the applicant and applies rules to derive conclusions.
                    </p>
                    <div class="mechanism-details">
                        <h4>Process:</h4>
                        <ol style="color: var(--text-secondary); padding-left: 20px; margin: 10px 0;">
                            <li>Initialize facts from applicant data</li>
                            <li>Match rules against facts</li>
                            <li>Fire matching rules to add new facts</li>
                            <li>Repeat until no new facts can be derived</li>
                            <li>Return final conclusion</li>
                        </ol>
                    </div>
                </div>

                <!-- Backward Chaining -->
                <div class="mechanism-card">
                    <div class="mechanism-icon">üéØ</div>
                    <h3>Backward Chaining</h3>
                    <p class="mechanism-description">
                        Top-down goal-driven reasoning that starts with desired conclusions and works backward to prove them.
                    </p>
                    <div class="mechanism-details">
                        <h4>Process:</h4>
                        <ol style="color: var(--text-secondary); padding-left: 20px; margin: 10px 0;">
                            <li>Define goal (desired decision)</li>
                            <li>Find rules that conclude the goal</li>
                            <li>Check if rule conditions are satisfied</li>
                            <li>Recursively prove sub-goals if needed</li>
                            <li>Return proof success/failure</li>
                        </ol>
                    </div>
                </div>

                <!-- Conflict Resolution -->
                <div class="mechanism-card">
                    <div class="mechanism-icon">‚ö°</div>
                    <h3>Conflict Resolution</h3>
                    <p class="mechanism-description">
                        Smart strategies to handle situations where multiple rules fire with conflicting conclusions.
                    </p>
                    <div class="mechanism-details">
                        <h4>Strategies:</h4>
                        <ul style="color: var(--text-secondary); padding-left: 20px; margin: 10px 0;">
                            <li><strong>Priority:</strong> Higher priority rules win</li>
                            <li><strong>Specificity:</strong> More specific rules win</li>
                            <li><strong>Combined:</strong> Priority + Specificity</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Decision Outcomes Section -->
    <section class="features">
        <h2 class="section-title">Decision Outcomes</h2>
        <div class="outcomes-grid">
            <div class="outcome-card approved">
                <div class="outcome-icon">‚úì</div>
                <h3>Approve Loan</h3>
                <p>Applicant meets strong criteria for loan approval. Immediate approval recommended.</p>
                <div class="outcome-criteria">
                    <strong>Typical Criteria:</strong>
                    <ul>
                        <li>High income (>60,000)</li>
                        <li>Excellent credit score (>750)</li>
                        <li>Stable employment</li>
                    </ul>
                </div>
            </div>

            <div class="outcome-card conditional">
                <div class="outcome-icon">‚Üí</div>
                <h3>Approve with Conditions</h3>
                <p>Applicant qualifies but with specific terms or requirements. Conditional approval.</p>
                <div class="outcome-criteria">
                    <strong>Typical Criteria:</strong>
                    <ul>
                        <li>Moderate income (40K-60K)</li>
                        <li>Good credit score (>700)</li>
                        <li>No existing debt</li>
                    </ul>
                </div>
            </div>

            <div class="outcome-card rejected">
                <div class="outcome-icon">‚úó</div>
                <h3>Reject Loan</h3>
                <p>Applicant does not meet minimum requirements for loan approval. Rejection.</p>
                <div class="outcome-criteria">
                    <strong>Typical Criteria:</strong>
                    <ul>
                        <li>Poor credit score (‚â§650)</li>
                        <li>Unemployed status</li>
                        <li>High existing debt</li>
                    </ul>
                </div>
            </div>

            <div class="outcome-card review">
                <div class="outcome-icon">‚äô</div>
                <h3>Manual Review</h3>
                <p>Applicant requires expert human review. Borderline or complex cases.</p>
                <div class="outcome-criteria">
                    <strong>Typical Criteria:</strong>
                    <ul>
                        <li>Borderline credit scores</li>
                        <li>Multiple dependents</li>
                        <li>Recent employment</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- System Statistics Section -->
    <section class="analysis-section">
        <div class="analysis-container">
            <h2 class="section-title">System Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìã</div>
                    <h3>Total Rules</h3>
                    <div class="stat-value" id="totalRules">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üî¥</div>
                    <h3>High Priority Rules</h3>
                    <div class="stat-value" id="highPriorityRules">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üü°</div>
                    <h3>Medium Priority Rules</h3>
                    <div class="stat-value" id="mediumPriorityRules">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üü¢</div>
                    <h3>Low Priority Rules</h3>
                    <div class="stat-value" id="lowPriorityRules">0</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Comparison Section -->
    <section class="features">
        <h2 class="section-title">Forward vs Backward Chaining</h2>
        <div class="comparison-table">
            <table>
                <thead>
                    <tr>
                        <th>Aspect</th>
                        <th>Forward Chaining</th>
                        <th>Backward Chaining</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Direction</strong></td>
                        <td>Bottom-up (Data ‚Üí Conclusion)</td>
                        <td>Top-down (Goal ‚Üí Facts)</td>
                    </tr>
                    <tr>
                        <td><strong>Starting Point</strong></td>
                        <td>Known facts about applicant</td>
                        <td>Desired decision/goal</td>
                    </tr>
                    <tr>
                        <td><strong>Process</strong></td>
                        <td>Apply rules iteratively to derive new facts</td>
                        <td>Recursively prove goal using rules</td>
                    </tr>
                    <tr>
                        <td><strong>Search Strategy</strong></td>
                        <td>Breadth-first exploration of all possibilities</td>
                        <td>Depth-first goal-driven search</td>
                    </tr>
                    <tr>
                        <td><strong>Best For</strong></td>
                        <td>Generating all possible conclusions</td>
                        <td>Finding specific answers quickly</td>
                    </tr>
                    <tr>
                        <td><strong>Efficiency</strong></td>
                        <td>Can explore irrelevant paths</td>
                        <td>More efficient for specific goals</td>
                    </tr>
                    <tr>
                        <td><strong>Explainability</strong></td>
                        <td>Shows all fired rules</td>
                        <td>Shows proof chain</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- Algorithm Details Section -->
    <section class="analysis-section">
        <div class="analysis-container">
            <h2 class="section-title">Algorithm Details</h2>
            
            <div class="algorithm-box">
                <h3>Forward Chaining Algorithm</h3>
                <pre style="background: rgba(22, 33, 62, 0.8); padding: 20px; border-radius: 8px; overflow-x: auto; color: #00d4aa;">
<code>1. Initialize FACTS with applicant data
2. Initialize RULES from knowledge base
3. FIRED_RULES = empty set
4. 
5. WHILE new facts can be derived:
6.     FOR each RULE in RULES:
7.         IF all conditions of RULE are satisfied by FACTS:
8.             IF RULE not in FIRED_RULES:
9.                 Add RULE.consequent to FACTS
10.                Add RULE to FIRED_RULES
11.                Log rule firing in TRACE
12.    
13. IF multiple consequents exist:
14.     DECISION = ResolvConflict(consequents)
15. ELSE:
16.     DECISION = consequent
17.
18. RETURN DECISION, TRACE</code>
                </pre>
            </div>

            <div class="algorithm-box">
                <h3>Backward Chaining Algorithm</h3>
                <pre style="background: rgba(22, 33, 62, 0.8); padding: 20px; border-radius: 8px; overflow-x: auto; color: #00d4aa;">
<code>1. PROVEN_GOALS = empty set
2. FAILED_GOALS = empty set
3.
4. FOR each GOAL in [RejectLoan, ApproveLoan, ...]:
5.     IF Prove(GOAL, applicant, depth=0):
6.         RETURN GOAL
7.
8. FUNCTION Prove(GOAL, applicant, depth):
9.     IF GOAL in PROVEN_GOALS:
10.        RETURN True
11.    IF GOAL in FAILED_GOALS:
12.        RETURN False
13.    IF depth > MAX_DEPTH:
14.        RETURN False
15.    
16.    RULES = FindRules(GOAL)
17.    SATISFIED_RULES = empty list
18.    
19.    FOR each RULE in RULES:
20.        IF RULE.conditions satisfied by applicant:
21.            Add RULE to SATISFIED_RULES
22.            Log rule evaluation in TRACE
23.    
24.    IF SATISFIED_RULES not empty:
25.        Add GOAL to PROVEN_GOALS
26.        RETURN True
27.    ELSE:
28.        Add GOAL to FAILED_GOALS
29.        RETURN False</code>
                </pre>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>About</h4>
                <p>Advanced Rule-Based Expert System for Loan Approval</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/analysis">Analysis</a></li>
                    <li><a href="/documentation">Documentation</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Technology</h4>
                <ul>
                    <li>Python Flask</li>
                    <li>Expert Systems</li>
                    <li>Modern Frontend</li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 LoanExpert AI. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Load rules and statistics
        document.addEventListener('DOMContentLoaded', async function() {
            await loadRules();
            await loadStatistics();
            AnimationUtils.fadeInOnLoad();
        });

        async function loadRules() {
            try {
                const response = await fetch('http://localhost:5000/api/rules');
                const data = await response.json();
                
                if (data.success) {
                    displayRules(data.data);
                }
            } catch (error) {
                console.error('Error loading rules:', error);
            }
        }

        function displayRules(rules) {
            const grid = document.getElementById('rulesGrid');
            grid.innerHTML = '';

            rules.forEach((rule, index) => {
                const card = document.createElement('div');
                card.className = 'rule-card';
                card.innerHTML = `
                    <div class="rule-header">
                        <span class="rule-id">${rule.rule_id}</span>
                        <span class="rule-priority ${rule.priority.toLowerCase()}">${rule.priority}</span>
                    </div>
                    <div class="rule-description">${rule.description}</div>
                    <div class="rule-consequent">
                        <strong>Decision:</strong> ${rule.consequent}
                    </div>
                    <div class="rule-specificity">
                        <strong>Specificity:</strong> ${rule.specificity}
                    </div>
                `;
                grid.appendChild(card);

                gsap.from(card, {
                    opacity: 0,
                    y: 20,
                    duration: 0.4,
                    delay: index * 0.05,
                    ease: 'back.out'
                });
            });
        }

        async function loadStatistics() {
            try {
                const response = await fetch('http://localhost:5000/api/statistics');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.data;
                    AnimationUtils.animateCounter(
                        document.getElementById('totalRules'),
                        stats.total_rules
                    );
                    AnimationUtils.animateCounter(
                        document.getElementById('highPriorityRules'),
                        stats.high_priority_rules
                    );
                    AnimationUtils.animateCounter(
                        document.getElementById('mediumPriorityRules'),
                        stats.medium_priority_rules
                    );
                    AnimationUtils.animateCounter(
                        document.getElementById('lowPriorityRules'),
                        stats.low_priority_rules
                    );
                }
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }
    </script>

    <!-- Import animation utilities -->
    <script src="{{ url_for('static', filename='js/animations.js') }}"></script>
</body>
</html>

<style>
    .rules-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: var(--spacing-lg);
        margin: var(--spacing-lg) 0;
    }

    .rule-card {
        padding: var(--spacing-md);
        background: rgba(22, 33, 62, 0.6);
        border: 1px solid rgba(102, 126, 234, 0.2);
        border-radius: var(--radius-lg);
        backdrop-filter: blur(10px);
        transition: all var(--transition-smooth);
    }

    .rule-card:hover {
        transform: translateY(-5px);
        border-color: rgba(102, 126, 234, 0.6);
        box-shadow: var(--shadow-glow);
    }

    .rule-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-md);
        padding-bottom: var(--spacing-md);
        border-bottom: 1px solid rgba(102, 126, 234, 0.2);
    }

    .rule-id {
        font-weight: 700;
        color: var(--text-accent);
        font-size: 1.1rem;
    }

    .rule-priority {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 700;
    }

    .rule-priority.high {
        background: rgba(255, 107, 107, 0.2);
        color: var(--error);
    }

    .rule-priority.medium {
        background: rgba(255, 165, 0, 0.2);
        color: var(--warning);
    }

    .rule-priority.low {
        background: rgba(0, 212, 170, 0.2);
        color: var(--success);
    }

    .rule-description {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: var(--spacing-md);
        line-height: 1.5;
    }

    .rule-consequent, .rule-specificity {
        padding: var(--spacing-sm);
        background: rgba(102, 126, 234, 0.1);
        border-radius: var(--radius-sm);
        font-size: 0.85rem;
        margin-bottom: var(--spacing-sm);
        color: var(--text-primary);
    }

    .mechanisms-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: var(--spacing-lg);
        margin: var(--spacing-lg) 0;
    }

    .mechanism-card {
        padding: var(--spacing-lg);
        background: rgba(22, 33, 62, 0.6);
        border: 1px solid rgba(102, 126, 234, 0.2);
        border-radius: var(--radius-lg);
        backdrop-filter: blur(10px);
        transition: all var(--transition-smooth);
    }

    .mechanism-card:hover {
        transform: translateY(-8px);
        border-color: rgba(102, 126, 234, 0.6);
        box-shadow: var(--shadow-glow);
    }

    .mechanism-icon {
        font-size: 2.5rem;
        margin-bottom: var(--spacing-md);
    }

    .mechanism-description {
        color: var(--text-secondary);
        margin-bottom: var(--spacing-md);
    }

    .mechanism-details {
        background: rgba(102, 126, 234, 0.1);
        padding: var(--spacing-md);
        border-radius: var(--radius-sm);
    }

    .mechanism-details h4 {
        color: var(--text-accent);
        margin-bottom: var(--spacing-sm);
    }

    .outcomes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--spacing-lg);
        margin: var(--spacing-lg) 0;
    }

    .outcome-card {
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        border-left: 4px solid;
        background: rgba(22, 33, 62, 0.8);
        transition: all var(--transition-smooth);
    }

    .outcome-card.approved {
        border-left-color: var(--success);
        background: rgba(0, 212, 170, 0.1);
    }

    .outcome-card.conditional {
        border-left-color: var(--warning);
        background: rgba(255, 165, 0, 0.1);
    }

    .outcome-card.rejected {
        border-left-color: var(--error);
        background: rgba(255, 107, 107, 0.1);
    }

    .outcome-card.review {
        border-left-color: var(--info);
        background: rgba(102, 126, 234, 0.1);
    }

    .outcome-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-md);
    }

    .outcome-icon {
        font-size: 2rem;
        margin-bottom: var(--spacing-md);
    }

    .outcome-criteria {
        margin-top: var(--spacing-md);
        padding-top: var(--spacing-md);
        border-top: 1px solid rgba(102, 126, 234, 0.2);
        font-size: 0.9rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-lg);
        margin: var(--spacing-lg) 0;
    }

    .stat-card {
        padding: var(--spacing-lg);
        background: rgba(22, 33, 62, 0.8);
        border: 1px solid rgba(102, 126, 234, 0.2);
        border-radius: var(--radius-lg);
        text-align: center;
        transition: all var(--transition-smooth);
    }

    .stat-card:hover {
        transform: translateY(-5px);
        border-color: rgba(102, 126, 234, 0.6);
        box-shadow: var(--shadow-glow);
    }

    .stat-icon {
        font-size: 2.5rem;
        margin-bottom: var(--spacing-md);
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-accent);
        margin: var(--spacing-md) 0;
    }

    .comparison-table {
        overflow-x: auto;
        background: rgba(22, 33, 62, 0.6);
        border-radius: var(--radius-lg);
        border: 1px solid rgba(102, 126, 234, 0.2);
        margin: var(--spacing-lg) 0;
    }

    .comparison-table table {
        width: 100%;
        border-collapse: collapse;
    }

    .comparison-table th {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(240, 147, 251, 0.2) 100%);
        padding: var(--spacing-md);
        text-align: left;
        color: var(--text-accent);
        font-weight: 600;
        border-bottom: 2px solid rgba(102, 126, 234, 0.3);
    }

    .comparison-table td {
        padding: var(--spacing-md);
        border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        color: var(--text-primary);
    }

    .comparison-table tbody tr:hover {
        background: rgba(102, 126, 234, 0.1);
    }

    .algorithm-box {
        background: rgba(22, 33, 62, 0.8);
        border: 1px solid rgba(102, 126, 234, 0.2);
        border-radius: var(--radius-lg);
        padding: var(--spacing-lg);
        margin-bottom: var(--spacing-lg);
    }

    .algorithm-box h3 {
        color: var(--text-accent);
        margin-bottom: var(--spacing-md);
    }

    .analysis-container {
        max-width: 1400px;
        margin: 0 auto;
    }

    .analysis-section {
        padding: var(--spacing-2xl) var(--spacing-lg);
    }
</style>
